##
## My Tokens
## eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiIsImtpZCI6IjI4YTMxOGY3LTAwMDAtYTFlYi03ZmExLTJjNzQzM2M2Y2NhNSJ9.eyJpc3MiOiJzdXBlcmNlbGwiLCJhdWQiOiJzdXBlcmNlbGw6Z2FtZWFwaSIsImp0aSI6ImFiYWIzODkxLWQ4M2QtNDgwMC1hNzVhLTVlYWNhYzc3ZDBmOSIsImlhdCI6MTUzODQ5NzM3Niwic3ViIjoiZGV2ZWxvcGVyL2M4ZDc4NGY5LWY0MDUtOTg5NC1mMjBiLTg3NGVhYzlhNzlmZSIsInNjb3BlcyI6WyJyb3lhbGUiXSwibGltaXRzIjpbeyJ0aWVyIjoiZGV2ZWxvcGVyL3NpbHZlciIsInR5cGUiOiJ0aHJvdHRsaW5nIn0seyJjaWRycyI6WyI5NS45Mi42OS4xMTciXSwidHlwZSI6ImNsaWVudCJ9XX0.EXORF-G5oyfpzvaRRLoBOw1SnYo-YfFlGnS5H8tKQwXwQhtDm1Cc12PeUcpno8hd2R4PanJdNLJF1dRuKQ0HXA
## Allowed IP: 95.92.69.117
##
## eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiIsImtpZCI6IjI4YTMxOGY3LTAwMDAtYTFlYi03ZmExLTJjNzQzM2M2Y2NhNSJ9.eyJpc3MiOiJzdXBlcmNlbGwiLCJhdWQiOiJzdXBlcmNlbGw6Z2FtZWFwaSIsImp0aSI6IjI4Njc3ODY1LTYyOGUtNDlmYy1hM2ZlLTI4MGY0ODNiNDc1YiIsImlhdCI6MTU0MDIyNDUzNSwic3ViIjoiZGV2ZWxvcGVyL2M4ZDc4NGY5LWY0MDUtOTg5NC1mMjBiLTg3NGVhYzlhNzlmZSIsInNjb3BlcyI6WyJyb3lhbGUiXSwibGltaXRzIjpbeyJ0aWVyIjoiZGV2ZWxvcGVyL3NpbHZlciIsInR5cGUiOiJ0aHJvdHRsaW5nIn0seyJjaWRycyI6WyIxODguMzcuMTQ4LjEyIl0sInR5cGUiOiJjbGllbnQifV19.ODcsrHxaptKU9fEAiEYluslCT0oV5n2Zc0zc0mYwvPm1misjr7tPQAEnVoSRFn8yuE7abCMht77NYE3cd7bykg
## Allowed IP: 188.37.148.12
##
## curl -X GET --header 'Accept: application/json' --header "authorization: Bearer <API token>" 'https://api.clashroyale.com/v1/tournaments'
## curl -X GET --header 'Accept: application/json' --header "authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiIsImtpZCI6IjI4YTMxOGY3LTAwMDAtYTFlYi03ZmExLTJjNzQzM2M2Y2NhNSJ9.eyJpc3MiOiJzdXBlcmNlbGwiLCJhdWQiOiJzdXBlcmNlbGw6Z2FtZWFwaSIsImp0aSI6ImFiYWIzODkxLWQ4M2QtNDgwMC1hNzVhLTVlYWNhYzc3ZDBmOSIsImlhdCI6MTUzODQ5NzM3Niwic3ViIjoiZGV2ZWxvcGVyL2M4ZDc4NGY5LWY0MDUtOTg5NC1mMjBiLTg3NGVhYzlhNzlmZSIsInNjb3BlcyI6WyJyb3lhbGUiXSwibGltaXRzIjpbeyJ0aWVyIjoiZGV2ZWxvcGVyL3NpbHZlciIsInR5cGUiOiJ0aHJvdHRsaW5nIn0seyJjaWRycyI6WyI5NS45Mi42OS4xMTciXSwidHlwZSI6ImNsaWVudCJ9XX0.EXORF-G5oyfpzvaRRLoBOw1SnYo-YfFlGnS5H8tKQwXwQhtDm1Cc12PeUcpno8hd2R4PanJdNLJF1dRuKQ0HXA" 'https://api.clashroyale.com/v1/players/%232UVYQPG2J'
## 

#Home token
#token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiIsImtpZCI6IjI4YTMxOGY3LTAwMDAtYTFlYi03ZmExLTJjNzQzM2M2Y2NhNSJ9.eyJpc3MiOiJzdXBlcmNlbGwiLCJhdWQiOiJzdXBlcmNlbGw6Z2FtZWFwaSIsImp0aSI6IjI4Njc3ODY1LTYyOGUtNDlmYy1hM2ZlLTI4MGY0ODNiNDc1YiIsImlhdCI6MTU0MDIyNDUzNSwic3ViIjoiZGV2ZWxvcGVyL2M4ZDc4NGY5LWY0MDUtOTg5NC1mMjBiLTg3NGVhYzlhNzlmZSIsInNjb3BlcyI6WyJyb3lhbGUiXSwibGltaXRzIjpbeyJ0aWVyIjoiZGV2ZWxvcGVyL3NpbHZlciIsInR5cGUiOiJ0aHJvdHRsaW5nIn0seyJjaWRycyI6WyIxODguMzcuMTQ4LjEyIl0sInR5cGUiOiJjbGllbnQifV19.ODcsrHxaptKU9fEAiEYluslCT0oV5n2Zc0zc0mYwvPm1misjr7tPQAEnVoSRFn8yuE7abCMht77NYE3cd7bykg"

#Office token
token <- "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiIsImtpZCI6IjI4YTMxOGY3LTAwMDAtYTFlYi03ZmExLTJjNzQzM2M2Y2NhNSJ9.eyJpc3MiOiJzdXBlcmNlbGwiLCJhdWQiOiJzdXBlcmNlbGw6Z2FtZWFwaSIsImp0aSI6ImFiYWIzODkxLWQ4M2QtNDgwMC1hNzVhLTVlYWNhYzc3ZDBmOSIsImlhdCI6MTUzODQ5NzM3Niwic3ViIjoiZGV2ZWxvcGVyL2M4ZDc4NGY5LWY0MDUtOTg5NC1mMjBiLTg3NGVhYzlhNzlmZSIsInNjb3BlcyI6WyJyb3lhbGUiXSwibGltaXRzIjpbeyJ0aWVyIjoiZGV2ZWxvcGVyL3NpbHZlciIsInR5cGUiOiJ0aHJvdHRsaW5nIn0seyJjaWRycyI6WyI5NS45Mi42OS4xMTciXSwidHlwZSI6ImNsaWVudCJ9XX0.EXORF-G5oyfpzvaRRLoBOw1SnYo-YfFlGnS5H8tKQwXwQhtDm1Cc12PeUcpno8hd2R4PanJdNLJF1dRuKQ0HXA"

myplayertag <- "/%232UVYQPG2J"
myclantag <- "/%23PG8VC9V"

tplayertag <- "/%23992V0CV2U"

## Files
warlogFile <- "data/warlog.RDS"
clanStatsFile <- "data/clanstats.RDS"
playerFile <- "data/players.RDS"

templateFile <- "data/template.html"
outputFile <- "../docs/index.html"

statsJSONfile <- "C:/Data/GDrive/98.CR/alkateia.json"
statsXLSfile <- "C:/Data/GDrive/98.CR/alkateia.xlsx"


# Tags in template HTML file to replace with the tables
clanWarTableTag <- "<CLAN_WAR_STATS_TABLE>"
playerTableTag <- "<CLAN_MEMBERS_STATS_TABLE>"


# ******************************************************************************************
# Support function to test if a file is already open
# Not immune to race condition...
is.open <- function (f) {
    suppressWarnings("try-error" %in% class(try(file(f, open = "w"), silent = TRUE)))
}



## Pretty names for clan stats columns
clanCols <- list(
    c("tag", "tag"),
    c("name", "Nome"),
    c("currentMember", "Membro?"),
    c("warsEntered", "Guerras"),
    c("collectionDayBattlesPlayed", "Batalhas Colecta"),
    c("cardsEarned", "Cartas ganhas"),
    c("battlesPlayed", "Batalhas finais"),
    c("wins", "Vitórias"),
    c("collectionBattleMisses", "Falhas em colecta"),
    c("finalBattleMisses", "Falhas em batalha"),
    c("winRate", "% de vitórias"),
    c("expLevel", "Nível"),
    c("trophies", "Troféus"),
    c("bestTrophies", "Máx. troféus"),
    c("totalWins", "Vitórias totais"),
    c("totalLosses", "Derrotas totais"),
    c("battleCount", "Batalhas totais"),
    c("threeCrownWins", "Vitórias 3 coroas"),
    c("challengeCardsWon", "Cartas em desafios"),
    c("challengeMaxWins", "Máx vitórias em desafios"),
    c("tournamentCardsWon", "Cartas em torneios"),
    c("tournamentBattleCount", "Batalhas em torneios"),
    c("role", "Nível no clã"),
    c("donations", "Doações"),
    c("donationsReceived", "Doações recebidas"),
    c("totalDonations", "Total de doações"),
    c("warDayWins", "Vitórias em guerras"),
    c("clanCardsCollected", "Cartas colectadas"),
    c("arena", "Arena"),
    c("WARSCORE", "Contributo para o clã"),
    c("joined", "Data entrada"), 
    c("age", "Dias no clã")
)


## XLX Description sheet
descs <- list(
    c("tag", "Identificador único do jogador"), 
    c("name.x", "Nome actual do jogador "), 
    c("currentMember", "Indica se é ou não membro actual do clã (Yes - é membro; No - já não é membro)"), 
    c("warsEntered", "Número de guerras de clã em que participou"), 
    c("collectionDayBattlesPlayed", "Número de batalhas da colecta em que participou. Deveria ser 3 x número de guerras, mas por vezes há quem não faça as 3 batalhas da colecta"),
    c("cardsEarned", "Número total de cartas ganhas para o clã nas colectas em que participou"), 
    c("battlesPlayed", "Número de batalhas finais que jogou. Pode ser maior que o Número de guerras em que participou porque alguns jogadores tÃÂªm 2 batalhas"), 
    c("wins", "Número de vitórias em batalhas finais"), 
    c("collectionBattleMisses", "Número de batalhas da colecta não jogadas (é mau...)"), 
    c("finalBattleMisses", "Número de batalhas finais não jogadas (é muito mau!!...)"), 
    c("winRate", "Taxa de vitórias em batalhas finais (alguém consegue 100%?)"), 
    c("WARSCORE", "Indicador do nível de desempenho em guerras (Quanto maior for, melhor!!)"), 
    c("expLevel", "nível no jogo (1 a 13)"), 
    c("trophies", "Número de troféus actual"), 
    c("bestTrophies", "Número máximo de troféus já atingido (PB)"), 
    c("totalWins", "Número total de vitórias em todas as batalhas no jogo"), 
    c("totalLosses", "Número total de derrotas em todas as batalhas no jogo"), 
    c("battleCount", "Número total de batalhas em que entrou no jogo"), 
    c("threeCrownWins", "Número de batalhas em que ganhou com 3 coroas"), 
    c("challengeCardsWon", "Número de cartas ganhas em desafios"), 
    c("challengeMaxWins", "Máximo de vitórias já atingido num desafio"), 
    c("tournamentCardsWon", "Número de cartas ganhas em torneios"), 
    c("tournamentBattleCount", "Número de batalhas em torneios"), 
    c("role", "nível no clã - Líder (leader), Co-líder (coLeader), Ancião (elder) ou Membro (member)"), 
    c("donations", "Número de cartas doadas nesta semana"), 
    c("donationsReceived", "Número de cartas recebidas esta semana"), 
    c("totalDonations", "Número total de doações efectuadas no jogo, desde sempre"), 
    c("warDayWins", "Total de vitórias em guerras de clãs (desde sempre, inclundo noutros clãs anteriores)"), 
    c("clanCardsCollected", "Total de cartas colectadas em guerras de clãs (desde sempre, incluindo noutros clãs anteriores)"), 
    c("arena", "Arena ou liga actual")
)